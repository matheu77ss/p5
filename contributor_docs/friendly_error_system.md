# üå∏ p5.js Friendly Error System (FES)

## Overview

The Friendly Error System (FES, üå∏) aims to help new programmers by providing error messages in simple, friendly language. It supplements browser console error messages by adding an alternative description of the error and links to helpful references.

The FES prints messages in the console window, as seen in the [p5.js Web Editor](https://github.com/processing/p5.js-web-editor) and your browser JavaScript console. The single minified file of p5 (p5.min.js) omits the FES.

 *We have an ongoing survey!* Please take a moment to fill out this 5-minute survey to help us improve the FES: [üå∏ SURVEY üå∏](https://forms.gle/2qStHJFSiw9XMCQJ8)


## Writing Friendly Error Messages

In this section, we will talk about how to contribute by writing and translating error messages.

The FES is a part of the p5.js' [internationalization](https://github.com/processing/p5.js/blob/main/contributor_docs/internationalization.md) effort. We generate all FES messages' content through [i18next](https://www.i18next.com/)-based `translator()` function. This dynamic error message generation happens for all languages, including English - the default language of p5.

We welcome contributions from all over the world! üåê

#### Writing Best Practice

Writers writing FES messages should prioritize lowering the barrier to understanding error messages and debugging.

Here are some highlights from our upcoming best practice doc:

* Use simple sentences. Consider breaking your sentence into smaller blocks for best utilizing i18next's [interpolation](https://www.i18next.com/translation-function/interpolation) feature.
* Keep the language friendly and inclusive. Look for possible bias and harm in your language. Adhere to [p5.js Code of Conduct](https://github.com/processing/p5.js/blob/main/CODE_OF_CONDUCT.md#p5js-code-of-conduct).
* Avoid using figures of speech. Prioritize cross-cultural communication.
* Try to spot possible "[expert blind spots](https://tilt.colostate.edu/TipsAndGuides/Tip/181)" in an error message and its related docs.
* Introduce one technical concept or term at a time‚Äîlink one external resource written in a beginner-friendly language with plenty of short, practical examples.

#### Translation File Location

`translator()` is based on i18next and imported from `src/core/internationalization.js`. It generates messages by looking up text data from a JSON translation file:
```
translations/{{detected locale code, default=en}}/translation.json
```

Example:
If the detected browser locale is Korean (language designator: `ko`), the `translator()` will read in translated text blocks from `translations/ko/translation.json`. Then `translator()` will assemble the text blocks into the final message.

The language designator can also include regional information, such as `es-PE` (Spanish from Peru).

#### Translation File Structure
`translation.json` has a [format used by i18next](https://www.i18next.com/misc/json-format).

The basic format of a translation file's item has a key and a value (message) in double quotation marks `""`, closed by the curly brackets `{}`:
```
{ "key": "value" }
```
For example, we have a ASCII logo saved in this format:
```
"logo": "    _ \n /\\| |/\\ \n \\ ` ' /  \n / , . \\  \n \\/|_|\\/ \n\n"
```
i18next supports interpolation, which allows us to pass a variable to generate a message dynamically. We use curly brackets twice `{{}}` to set a placeholder of the variable:
```
"greeting": "Hello, {{who}}!"
```
Here, the key is `greeting`, and the variable name is `who`.

To dynamically generate this message, we will need to pass a value:
```
translator('greeting', { who: 'everyone' } );
```
The result generated by `translator` will look like this:
```
Hello, everyone!
```

Here is an item from `fes`'s `fileLoadError` that demonstrates interpolation:
```
"image": "It looks like there was a problem loading your image. {{suggestion}}"
```
To dynamically generate the final message, the FES will call `translator()` with the key and a pre-generated `suggestion` value.
```
translator('fes.fileLoadError.image', { suggestion });
```

#### How to Add or Modify Translation

The [internationalization doc](https://github.com/processing/p5.js/blob/main/contributor_docs/internationalization.md) has a step-by-step guide on adding and modifying translation files.


## Understanding How FES Works
In this section, we will give an overview of how FES generates and displays messages. For more detailed information on the FES functions, please see our [FES Reference + Dev Notes](https://github.com/almchung/p5jsdocs/blob/main/fes_reference_dev_notes.md).

#### Overview
p5.js calls the FES from multiple locations for different situations, when:
* The browser throws an error.
* The user code calls a function from the p5.js API.
* Other custom cases where the user would benefit from a help message.

#### FES Code Location
You can find the core components of the FES inside:
`src/core/friendly_errors`.
You can find the translation files used by the `translator()` inside:
`translations/`.

#### FES Message Generators
These functions are responsible for catching errors and generating FES messages:
* [`_friendlyFileLoadError()`](https://github.com/almchung/p5jsdocs/blob/main/fes_reference_dev_notes.md#corefriendly_errorsfile_errorsfriendlyfileloaderror) catches file loading errors.
* [`_validateParameters()`](https://github.com/almchung/p5jsdocs/blob/main/fes_reference_dev_notes.md#corefriendly_errorsvalidate_paramsvalidateparameters) checks a p5.js function‚Äôs input parameters based on inline documentations.
* [`_fesErrorMontitor()`](https://github.com/almchung/p5jsdocs/blob/main/fes_reference_dev_notes.md#corefriendly_errorsfes_corefeserrormonitor) handles global errors.
* `helpForMisusedAtTopLevelCode()` is called on window load to check for use of p5.js functions outside of setup() or draw().
* [`fesCodeReader()`](https://github.com/almchung/p5jsdocs/blob/main/fes_reference_dev_notes.md#corefriendly_errorsfes_coresketch_readerfescodereader) checks if a p5.js reserved constant or function is redefined by the user.
* [`checkForUserDefinedFunctions()`](https://github.com/almchung/p5jsdocs/blob/main/fes_reference_dev_notes.md#corefriendly_errorsfes_corecheckforuserdefinedfunctions) checks if any user defined function has been used with a capitalization mistake.

#### FES Message Displayer
`fes_core.js/_friendlyError()` prints generated friendly error messages in the console. For example:

```
p5._friendlyError(
  translator('fes.globalErrors.type.notfunc', translationObj)
);
```
This function can be called anywhere in p5.

## Turning Off the FES
There may be cases where you want to [disable the FES for performance](https://github.com/processing/p5.js/wiki/Optimizing-p5.js-Code-for-Performance#disable-the-friendly-error-system-fes).

`p5.disableFriendlyErrors` allows you to turn off the FES when set to `true`.

Example:
```
p5.disableFriendlyErrors = true;

function setup() {
  createCanvas(100, 50);
}
```

The single minified file of p5 (p5.min.js) automatically omits the FES.
